import java.io.File;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Date;
import java.util.Scanner;
import javafx.util.converter.LocalDateTimeStringConverter;
public class OrderDataStructure{
    private LinkedList<OrderNode> allOrders;
    private CustomerDataStructure allCustomers;  
    static DateTimeFormatter df = DateTimeFormatter.ofPattern("yyyy-MM-dd");
    public OrderDataStructure(LinkedList<CustomerNode> inputCustomers,LinkedList<OrderNode> allOrders) {
        allCustomers =new CustomerDataStructure(inputCustomers) ;
        this.allOrders=allOrders;
    }
    
    public OrderDataStructure() {
        allCustomers=new CustomerDataStructure();
        allOrders = new LinkedList<>();      
    }
public LinkedList<OrderNode>get_Orders()
{
return allOrders;
}
 public OrderNode searchOrderById(int id) {
        if (allOrders.empty()) return null;

        allOrders.findFirst();
        while (true) {
            OrderNode o = allOrders.retrieve();
            if (o.getOrderID() == id)
                return o;
            if (allOrders.last())
                break;
            allOrders.findNext();
        }
        return null;
    }
public void UpdateOrderState(int id, String newStatus) {
    if (allOrders.empty()) {
        System.out.println("No orders found");
        return;
    }

    allOrders.findFirst();
    while (true) {
        OrderNode o = allOrders.retrieve();
        if (o.getOrderID() == id) {
            o.setStatus(newStatus); 
            System.out.println("Order " + id + " status updated to: " + newStatus);
            return;
        }
        if (allOrders.last())
            break;
        allOrders.findNext();
    }
    System.out.println("Order ID not found");
}

  public void removeOrder(int id) {
  
             if (searchOrderById(id)!=null) {
                allOrders.remove();
                System.out.println("Order removed: " + id);
            }
           else
        System.out.println("Order ID not found");
    }
 public  void assign(OrderNode ord){
       CustomerNode p= allCustomers.searchById(ord.getCustomerID());
       if(p==null)
              System.out.println("Customer with ID"+ord.getCustomerID()+"does not exist to assign this order to");
       else
           p.addOrder(ord);
     }
 public void addOrder(OrderNode ord) {
        if (searchOrderById(ord.getOrderID()) == null) { 
            allOrders.addLast(ord);
            assign(ord);           
          
        } else {
            System.out.println("Order with ID " + ord.getOrderID() + " already exists");
        }
    }
 public static OrderNode convertStringToProduct(String Line)
    {
          String a[]=Line.split(",");              
             int orderId = Integer.parseInt(a[0].trim().replace("\"", ""));            
            int customerId = Integer.parseInt(a[1].trim().replace("\"", ""));            
             String productIds = a[2].trim().replace("\"", "");            
            double totalPrice = Double.parseDouble(a[3]);             
            LocalDate date = LocalDate.parse(a[4], df);                
           String status = a[5].trim();

            OrderNode ord = new OrderNode(orderId, customerId, productIds, totalPrice, date, status);
          
    return ord;
    }
   public void loadOrders(String fileName) {
    try {
        File f = new File(fileName);
        Scanner read = new Scanner(f);        
        DateTimeFormatter df = DateTimeFormatter.ofPattern("yyyy-MM-dd");
        System.out.println("Reading file: " + fileName);
        System.out.println("✦────────────────────────────────✦");
        read.nextLine();
        while (read.hasNextLine()) {
            String line = read.nextLine().trim();                               
           OrderNode ord=convertStringToProduct(line);
           addOrder(ord);
        }

        read.close();
        System.out.println("File loaded successfully \n");

    } catch (Exception e) {
        System.out.println("Error loading allOrders: " + e.getMessage());
    }
}

    
    public void displayAllOrders() {
        if (allOrders.empty()) {
            System.out.println(" No allOrders found!");
            return;
        }

        System.out.println("OrderID\tCustomerID\tProductIDs\t\tTotalPrice\tDate\t\tStatus");
        System.out.println("✦────────────────────────────────✦");
        
        allOrders.findFirst();
        while (true) {
            OrderNode o = allOrders.retrieve();
            o.display();
            if (allOrders.last())
                break;
            allOrders.findNext();
        }

        System.out.println("✦────────────────────────────────✦");
    }
 

}
